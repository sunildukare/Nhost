(function(V,ee){typeof exports=="object"&&typeof module!="undefined"?ee(exports):typeof define=="function"&&define.amd?define(["exports"],ee):(V=typeof globalThis!="undefined"?globalThis:V||self,ee(V["@nhost/hasura-storage-js"]={}))})(this,function(V){"use strict";var ee=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ot(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ke={exports:{}};(function(t,e){(function(r){function n(a){var i=a&&a.Promise||r.Promise,o=a&&a.XMLHttpRequest||r.XMLHttpRequest;return function(){var u=Object.create(r,{fetch:{value:void 0,writable:!0}});return function(f,l){l(e)}(this,function(f){var l=typeof u!="undefined"&&u||typeof self!="undefined"&&self||typeof l!="undefined"&&l,p={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function w(s){return s&&DataView.prototype.isPrototypeOf(s)}if(p.arrayBuffer)var d=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(s){return s&&d.indexOf(Object.prototype.toString.call(s))>-1};function m(s){if(typeof s!="string"&&(s=String(s)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(s)||s==="")throw new TypeError("Invalid character in header field name");return s.toLowerCase()}function g(s){return typeof s!="string"&&(s=String(s)),s}function E(s){var c={next:function(){var b=s.shift();return{done:b===void 0,value:b}}};return p.iterable&&(c[Symbol.iterator]=function(){return c}),c}function y(s){this.map={},s instanceof y?s.forEach(function(c,b){this.append(b,c)},this):Array.isArray(s)?s.forEach(function(c){this.append(c[0],c[1])},this):s&&Object.getOwnPropertyNames(s).forEach(function(c){this.append(c,s[c])},this)}y.prototype.append=function(s,c){s=m(s),c=g(c);var b=this.map[s];this.map[s]=b?b+", "+c:c},y.prototype.delete=function(s){delete this.map[m(s)]},y.prototype.get=function(s){return s=m(s),this.has(s)?this.map[s]:null},y.prototype.has=function(s){return this.map.hasOwnProperty(m(s))},y.prototype.set=function(s,c){this.map[m(s)]=g(c)},y.prototype.forEach=function(s,c){for(var b in this.map)this.map.hasOwnProperty(b)&&s.call(c,this.map[b],b,this)},y.prototype.keys=function(){var s=[];return this.forEach(function(c,b){s.push(b)}),E(s)},y.prototype.values=function(){var s=[];return this.forEach(function(c){s.push(c)}),E(s)},y.prototype.entries=function(){var s=[];return this.forEach(function(c,b){s.push([b,c])}),E(s)},p.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function S(s){if(s.bodyUsed)return i.reject(new TypeError("Already read"));s.bodyUsed=!0}function A(s){return new i(function(c,b){s.onload=function(){c(s.result)},s.onerror=function(){b(s.error)}})}function P(s){var c=new FileReader,b=A(c);return c.readAsArrayBuffer(s),b}function G(s){var c=new FileReader,b=A(c);return c.readAsText(s),b}function L(s){for(var c=new Uint8Array(s),b=new Array(c.length),U=0;U<c.length;U++)b[U]=String.fromCharCode(c[U]);return b.join("")}function $(s){if(s.slice)return s.slice(0);var c=new Uint8Array(s.byteLength);return c.set(new Uint8Array(s)),c.buffer}function H(){return this.bodyUsed=!1,this._initBody=function(s){this.bodyUsed=this.bodyUsed,this._bodyInit=s,s?typeof s=="string"?this._bodyText=s:p.blob&&Blob.prototype.isPrototypeOf(s)?this._bodyBlob=s:p.formData&&FormData.prototype.isPrototypeOf(s)?this._bodyFormData=s:p.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)?this._bodyText=s.toString():p.arrayBuffer&&p.blob&&w(s)?(this._bodyArrayBuffer=$(s.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):p.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(s)||h(s))?this._bodyArrayBuffer=$(s):this._bodyText=s=Object.prototype.toString.call(s):this._bodyText="",this.headers.get("content-type")||(typeof s=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var s=S(this);if(s)return s;if(this._bodyBlob)return i.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return i.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return i.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var s=S(this);return s||(ArrayBuffer.isView(this._bodyArrayBuffer)?i.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):i.resolve(this._bodyArrayBuffer))}else return this.blob().then(P)}),this.text=function(){var s=S(this);if(s)return s;if(this._bodyBlob)return G(this._bodyBlob);if(this._bodyArrayBuffer)return i.resolve(L(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return i.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(N)}),this.json=function(){return this.text().then(JSON.parse)},this}var z=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function C(s){var c=s.toUpperCase();return z.indexOf(c)>-1?c:s}function x(s,c){if(!(this instanceof x))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');c=c||{};var b=c.body;if(s instanceof x){if(s.bodyUsed)throw new TypeError("Already read");this.url=s.url,this.credentials=s.credentials,c.headers||(this.headers=new y(s.headers)),this.method=s.method,this.mode=s.mode,this.signal=s.signal,!b&&s._bodyInit!=null&&(b=s._bodyInit,s.bodyUsed=!0)}else this.url=String(s);if(this.credentials=c.credentials||this.credentials||"same-origin",(c.headers||!this.headers)&&(this.headers=new y(c.headers)),this.method=C(c.method||this.method||"GET"),this.mode=c.mode||this.mode||null,this.signal=c.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&b)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(b),(this.method==="GET"||this.method==="HEAD")&&(c.cache==="no-store"||c.cache==="no-cache")){var U=/([?&])_=[^&]*/;if(U.test(this.url))this.url=this.url.replace(U,"$1_="+new Date().getTime());else{var O=/\?/;this.url+=(O.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}x.prototype.clone=function(){return new x(this,{body:this._bodyInit})};function N(s){var c=new FormData;return s.trim().split("&").forEach(function(b){if(b){var U=b.split("="),O=U.shift().replace(/\+/g," "),D=U.join("=").replace(/\+/g," ");c.append(decodeURIComponent(O),decodeURIComponent(D))}}),c}function q(s){var c=new y,b=s.replace(/\r?\n[\t ]+/g," ");return b.split("\r").map(function(U){return U.indexOf(`
`)===0?U.substr(1,U.length):U}).forEach(function(U){var O=U.split(":"),D=O.shift().trim();if(D){var ce=O.join(":").trim();c.append(D,ce)}}),c}H.call(x.prototype);function B(s,c){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');c||(c={}),this.type="default",this.status=c.status===void 0?200:c.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in c?c.statusText:"",this.headers=new y(c.headers),this.url=c.url||"",this._initBody(s)}H.call(B.prototype),B.prototype.clone=function(){return new B(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},B.error=function(){var s=new B(null,{status:0,statusText:""});return s.type="error",s};var ne=[301,302,303,307,308];B.redirect=function(s,c){if(ne.indexOf(c)===-1)throw new RangeError("Invalid status code");return new B(null,{status:c,headers:{location:s}})},f.DOMException=l.DOMException;try{new f.DOMException}catch{f.DOMException=function(c,b){this.message=c,this.name=b;var U=Error(c);this.stack=U.stack},f.DOMException.prototype=Object.create(Error.prototype),f.DOMException.prototype.constructor=f.DOMException}function ie(s,c){return new i(function(b,U){var O=new x(s,c);if(O.signal&&O.signal.aborted)return U(new f.DOMException("Aborted","AbortError"));var D=new o;function ce(){D.abort()}D.onload=function(){var k={status:D.status,statusText:D.statusText,headers:q(D.getAllResponseHeaders()||"")};k.url="responseURL"in D?D.responseURL:k.headers.get("X-Request-URL");var Ce="response"in D?D.response:D.responseText;setTimeout(function(){b(new B(Ce,k))},0)},D.onerror=function(){setTimeout(function(){U(new TypeError("Network request failed"))},0)},D.ontimeout=function(){setTimeout(function(){U(new TypeError("Network request failed"))},0)},D.onabort=function(){setTimeout(function(){U(new f.DOMException("Aborted","AbortError"))},0)};function Y(k){try{return k===""&&l.location.href?l.location.href:k}catch{return k}}D.open(O.method,Y(O.url),!0),O.credentials==="include"?D.withCredentials=!0:O.credentials==="omit"&&(D.withCredentials=!1),"responseType"in D&&(p.blob?D.responseType="blob":p.arrayBuffer&&O.headers.get("Content-Type")&&O.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(D.responseType="arraybuffer")),c&&typeof c.headers=="object"&&!(c.headers instanceof y)?Object.getOwnPropertyNames(c.headers).forEach(function(k){D.setRequestHeader(k,g(c.headers[k]))}):O.headers.forEach(function(k,Ce){D.setRequestHeader(Ce,k)}),O.signal&&(O.signal.addEventListener("abort",ce),D.onreadystatechange=function(){D.readyState===4&&O.signal.removeEventListener("abort",ce)}),D.send(typeof O._bodyInit=="undefined"?null:O._bodyInit)})}ie.polyfill=!0,l.fetch||(l.fetch=ie,l.Headers=y,l.Request=x,l.Response=B),f.Headers=y,f.Request=x,f.Response=B,f.fetch=ie,Object.defineProperty(f,"__esModule",{value:!0})}),{fetch:u.fetch,Headers:u.Headers,Request:u.Request,Response:u.Response,DOMException:u.DOMException}}()}t.exports=n})(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:ee)})(ke,ke.exports);var Qt=ke.exports;const st=ot(Qt);var Zt=typeof self=="object"?self.FormData:window.FormData;const $e=ot(Zt);let ut=globalThis.fetch;const qe=async(t,e,{accessToken:r,name:n,fileId:a,bucketId:i,adminSecret:o,onUploadProgress:u,headers:f={}}={})=>{var w;const l={...f};i&&e.append("bucket-id",i),o&&(l["x-hasura-admin-secret"]=o),r&&(l.Authorization=`Bearer ${r}`);const p=`${t}/files`;if(typeof XMLHttpRequest=="undefined")try{e instanceof $e&&(ut=st().fetch);const d=await ut(p,{method:"POST",headers:l,body:e}),h=await d.json();return d.ok?{fileMetadata:h,error:null}:{error:{status:d.status,message:((w=h==null?void 0:h.error)==null?void 0:w.message)||d.statusText,error:d.statusText},fileMetadata:null}}catch(d){return{error:{status:0,message:d.message,error:d.message},fileMetadata:null}}return new Promise(d=>{let h=new XMLHttpRequest;h.responseType="json",h.onload=()=>{var m,g,E,y,S;return h.status<200||h.status>=300?d({fileMetadata:null,error:{error:(g=(m=h.response)==null?void 0:m.error)!=null?g:h.response,message:(S=(y=(E=h.response)==null?void 0:E.error)==null?void 0:y.message)!=null?S:h.response,status:h.status}}):d({fileMetadata:h.response,error:null})},h.onerror=()=>d({fileMetadata:null,error:{error:h.statusText,message:h.statusText,status:h.status}}),u&&h.upload.addEventListener("progress",u,!1),h.open("POST",p,!0),Object.entries(l).forEach(([m,g])=>{h.setRequestHeader(m,g)}),h.send(e)})};function xe(t,e){if(!e||Object.keys(e).length===0)return t;const r=new URL(t),n=Object.entries(e).reduce((a,[i,o])=>({...a,[i.charAt(0)]:o}),{});return Object.entries(n).forEach(([a,i])=>{i&&r.searchParams.set(a,i)}),r.toString()}let de;typeof de=="undefined"&&(de=st().fetch);class ft{constructor({url:e}){this.headers={},this.url=e}async uploadFormData({formData:e,bucketId:r,headers:n}){const{error:a,fileMetadata:i}=await qe(this.url,e,{bucketId:r,headers:{...this.headers,...n},accessToken:this.accessToken,adminSecret:this.adminSecret});return a?{fileMetadata:null,error:a}:i&&!("processedFiles"in i)?{fileMetadata:{processedFiles:[i]},error:null}:{fileMetadata:i,error:null}}async uploadFile({file:e,bucketId:r,id:n,name:a,headers:i}){const o=typeof window=="undefined"?new $e:new FormData;o.append("file[]",e),o.append("metadata[]",JSON.stringify({id:n,name:a}));const{error:u,fileMetadata:f}=await qe(this.url,o,{accessToken:this.accessToken,adminSecret:this.adminSecret,bucketId:r,fileId:n,name:a,headers:{...this.headers,...i}});return u?{fileMetadata:null,error:u}:f&&"processedFiles"in f?{fileMetadata:f.processedFiles[0],error:null}:{fileMetadata:f,error:null}}async downloadFile(e){try{const{fileId:r,headers:n,...a}=e,i=xe(`${this.url}/files/${r}`,a),o=await de(i,{method:"GET",headers:{...this.generateAuthHeaders(),...this.headers,...n}});if(!o.ok)throw new Error(await o.text());return{file:await o.blob(),error:null}}catch(r){return{file:null,error:r}}}async getPresignedUrl(e){try{const{fileId:r,headers:n}=e,a=await de(`${this.url}/files/${r}/presignedurl`,{method:"GET",headers:{...this.generateAuthHeaders(),...this.headers,...n}});if(!a.ok)throw new Error(await a.text());return{presignedUrl:await a.json(),error:null}}catch(r){return{presignedUrl:null,error:r}}}async delete(e){try{const{fileId:r,headers:n}=e,a=await de(`${this.url}/files/${r}`,{method:"DELETE",headers:{...this.generateAuthHeaders(),...this.headers,...n}});if(!a.ok)throw new Error(await a.text());return{error:null}}catch(r){return{error:r}}}setAccessToken(e){return this.accessToken=e,this}setAdminSecret(e){return this.adminSecret=e,this}getHeaders(){return this.headers}setHeaders(e){return e?(this.headers={...this.headers,...e},this):this}unsetHeaders(){const e=this.headers["x-hasura-role"];return this.headers=e?{"x-hasura-role":e}:{},this}generateAuthHeaders(){if(!(!this.adminSecret&&!this.accessToken))return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:{Authorization:`Bearer ${this.accessToken}`}}}class er{constructor({url:e,adminSecret:r}){this.url=e,this.api=new ft({url:e}),this.setAdminSecret(r)}async upload(e){return"file"in e?this.api.uploadFile(e):this.api.uploadFormData(e)}getPublicUrl(e){const{fileId:r,...n}=e;return xe(`${this.url}/files/${r}`,n)}async getPresignedUrl(e){const{fileId:r,headers:n,...a}=e,{presignedUrl:i,error:o}=await this.api.getPresignedUrl(e);if(o)return{presignedUrl:null,error:o};if(!i)return{presignedUrl:null,error:new Error("Invalid file id")};const u=xe(i.url,a);return{presignedUrl:{...i,url:u},error:null}}async download(e){const{file:r,error:n}=await this.api.downloadFile(e);return n?{file:null,error:n}:r?{file:r,error:null}:{file:null,error:new Error("File does not exist")}}async delete(e){const{error:r}=await this.api.delete(e);return r?{error:r}:{error:null}}setAccessToken(e){return this.api.setAccessToken(e),this}setAdminSecret(e){return this.api.setAdminSecret(e),this}getHeaders(){return this.getHeaders()}setHeaders(e){return this.api.setHeaders(e),this}unsetHeaders(){return this.api.unsetHeaders(),this}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var v=function(){return v=Object.assign||function(e){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},v.apply(this,arguments)};function Ge(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(r[n[a]]=t[n[a]]);return r}function _(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function j(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(u){o={error:u}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function I(t,e,r){if(r||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}var R;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(R||(R={}));var ae;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(ae||(ae={}));var ze=R.Start,Xe=R.Stop,he=R.Raise,Ae=R.Send,lt=R.Cancel,ct=R.NullEvent,Oe=R.Assign,tr=R.After,rr=R.DoneState,Ve=R.Log,dt=R.Init,Te=R.Invoke,nr=R.ErrorExecution,ir=R.ErrorPlatform,ht=R.ErrorCustom,Je=R.Update,vt=R.Choose,pt=R.Pure;const ar=Object.freeze(Object.defineProperty({__proto__:null,after:tr,assign:Oe,cancel:lt,choose:vt,doneState:rr,error:ht,errorExecution:nr,errorPlatform:ir,init:dt,invoke:Te,log:Ve,nullEvent:ct,pure:pt,raise:he,send:Ae,start:ze,stop:Xe,update:Je},Symbol.toStringTag,{value:"Module"}));var yt=".",gt={},Ye="xstate.guard",or="",J=process.env.NODE_ENV==="production",Pe;function We(t,e,r){r===void 0&&(r=yt);var n=ve(t,r),a=ve(e,r);return T(a)?T(n)?a===n:!1:T(n)?n in a:Object.keys(n).every(function(i){return i in a?We(n[i],a[i]):!1})}function mt(t){try{return T(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Ke(t,e){try{return ye(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function sr(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function ve(t,e){if(sr(t))return t.value;if(ye(t))return De(t);if(typeof t!="string")return t;var r=Ke(t,e);return De(r)}function De(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function pe(t,e){for(var r={},n=Object.keys(t),a=0;a<n.length;a++){var i=n[a];r[i]=e(t[i],i,t,a)}return r}function wt(t,e,r){var n,a,i={};try{for(var o=_(Object.keys(t)),u=o.next();!u.done;u=o.next()){var f=u.value,l=t[f];r(l)&&(i[f]=e(l,f,t))}}catch(p){n={error:p}}finally{try{u&&!u.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}var ur=function(t){return function(e){var r,n,a=e;try{for(var i=_(t),o=i.next();!o.done;o=i.next()){var u=o.value;a=a[u]}}catch(f){r={error:f}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}};function fr(t,e){return function(r){var n,a,i=r;try{for(var o=_(t),u=o.next();!u.done;u=o.next()){var f=u.value;i=i[e][f]}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}}function je(t){if(!t)return[[]];if(T(t))return[[t]];var e=M(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:je(t[r]).map(function(a){return[r].concat(a)})}));return e}function M(t){var e;return(e=[]).concat.apply(e,I([],j(t),!1))}function bt(t){return ye(t)?t:[t]}function W(t){return t===void 0?[]:bt(t)}function St(t,e,r){var n,a;if(F(t))return t(e,r.data);var i={};try{for(var o=_(Object.keys(t)),u=o.next();!u.done;u=o.next()){var f=u.value,l=t[f];F(l)?i[f]=l(e,r.data):i[f]=l}}catch(p){n={error:p}}finally{try{u&&!u.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function lr(t){return/^(done|error)\./.test(t)}function cr(t,e){var r,n,a=j([[],[]],2),i=a[0],o=a[1];try{for(var u=_(t),f=u.next();!f.done;f=u.next()){var l=f.value;e(l)?i.push(l):o.push(l)}}catch(p){r={error:p}}finally{try{f&&!f.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return[i,o]}function Et(t,e){return pe(t.states,function(r,n){if(r){var a=(T(e)?void 0:e[n])||(r?r.current:void 0);if(a)return{current:a,states:Et(r,a)}}})}function dr(t,e){return{current:e,states:Et(t,e)}}function xt(t,e,r,n){J||K(!!t,"Attempting to update undefined context");var a=t&&r.reduce(function(i,o){var u,f,l=o.assignment,p={state:n,action:o,_event:e},w={};if(F(l))w=l(i,e.data,p);else try{for(var d=_(Object.keys(l)),h=d.next();!h.done;h=d.next()){var m=h.value,g=l[m];w[m]=F(g)?g(i,e.data,p):g}}catch(E){u={error:E}}finally{try{h&&!h.done&&(f=d.return)&&f.call(d)}finally{if(u)throw u.error}}return Object.assign({},i,w)},t);return a}var K=function(){};J||(K=function(t,e){var r=t instanceof Error?t:void 0;if(!(!r&&t)&&console!==void 0){var n=["Warning: ".concat(e)];r&&n.push(r),console.warn.apply(console,n)}});function ye(t){return Array.isArray(t)}function F(t){return typeof t=="function"}function T(t){return typeof t=="string"}function At(t,e){if(t)return T(t)?{type:Ye,name:t,predicate:e?e[t]:void 0}:F(t)?{type:Ye,name:t.name,predicate:t}:t}var Ot=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Pe={},Pe[Ot]=function(){return this},Pe[Symbol.observable]=function(){return this};function te(t){return!!t&&"__xstatenode"in t}var hr=function(){var t=0;return function(){return t++,t.toString(16)}}();function Qe(t,e){return T(t)||typeof t=="number"?v({type:t},e):t}function ge(t,e){if(!T(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=Qe(t);return v({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function oe(t,e){var r=bt(e).map(function(n){return typeof n=="undefined"||typeof n=="string"||te(n)?{target:n,event:t}:v(v({},n),{event:t})});return r}function vr(t){if(!(t===void 0||t===or))return W(t)}function Tt(t,e,r,n,a){var i=t.options.guards,o={state:a,cond:e,_event:n};if(e.type===Ye)return((i==null?void 0:i[e.name])||e.predicate)(r,n.data,o);var u=i==null?void 0:i[e.type];if(!u)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return u(r,n.data,o)}function pr(t){return typeof t=="string"?{type:t}:t}function Re(t,e){return"".concat(t,":invocation[").concat(e,"]")}function Pt(t){return(t.type===he||t.type===Ae&&t.to===ae.Internal)&&typeof t.delay!="number"}var Ue=ge({type:dt});function Ze(t,e){return e&&e[t]||void 0}function se(t,e){var r;if(T(t)||typeof t=="number"){var n=Ze(t,e);F(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(F(t))r={type:t.name||t.toString(),exec:t};else{var n=Ze(t.type,e);if(F(n))r=v(v({},t),{exec:n});else if(n){var a=n.type||t.type;r=v(v(v({},n),t),{type:a})}else r=t}return r}var Q=function(t,e){if(!t)return[];var r=ye(t)?t:[t];return r.map(function(n){return se(n,e)})};function Ne(t){var e=se(t);return v(v({id:T(t)?t:e.id},e),{type:e.type})}function Dt(t,e){return{type:he,event:typeof t=="function"?t:Qe(t),delay:e?e.delay:void 0,id:e==null?void 0:e.id}}function jt(t,e,r,n){var a={_event:r},i=ge(F(t.event)?t.event(e,r.data,a):t.event),o;if(T(t.delay)){var u=n&&n[t.delay];o=F(u)?u(e,r.data,a):u}else o=F(t.delay)?t.delay(e,r.data,a):t.delay;return v(v({},t),{type:he,_event:i,delay:o})}function re(t,e){return{to:e?e.to:void 0,type:Ae,event:F(t)?t:Qe(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:F(t)?t.name:mt(t)}}function Rt(t,e,r,n){var a={_event:r},i=ge(F(t.event)?t.event(e,r.data,a):t.event),o;if(T(t.delay)){var u=n&&n[t.delay];o=F(u)?u(e,r.data,a):u}else o=F(t.delay)?t.delay(e,r.data,a):t.delay;var f=F(t.to)?t.to(e,r.data,a):t.to;return v(v({},t),{to:f,_event:i,event:i.data,delay:o})}function et(t,e){return re(t,v(v({},e),{to:ae.Parent}))}function yr(t,e,r){return re(e,v(v({},r),{to:t}))}function gr(){return et(Je)}function mr(t,e){return re(t,v(v({},e),{to:function(r,n,a){var i=a._event;return i.origin}}))}var wr=function(t,e){return{context:t,event:e}};function br(t,e){return t===void 0&&(t=wr),{type:Ve,label:e,expr:t}}var Ut=function(t,e,r){return v(v({},t),{value:T(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},Nt=function(t){return{type:lt,sendId:t}};function It(t){var e=Ne(t);return{type:R.Start,activity:e,exec:void 0}}function Ft(t){var e=F(t)?t:Ne(t);return{type:R.Stop,activity:e,exec:void 0}}function Lt(t,e,r){var n=F(t.activity)?t.activity(e,r.data):t.activity,a=typeof n=="string"?{id:n}:n,i={type:R.Stop,activity:a};return i}var _t=function(t){return{type:Oe,assignment:t}};function Sr(t){return typeof t=="object"&&"type"in t}function Mt(t,e){var r=e?"#".concat(e):"";return"".concat(R.After,"(").concat(t,")").concat(r)}function me(t,e){var r="".concat(R.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Bt(t,e){var r="".concat(R.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Ht(t,e){var r="".concat(R.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Er(t){return{type:R.Pure,get:t}}function xr(t,e){if(!J&&(!t||typeof t=="function")){var r=t;t=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];var i=typeof r=="function"?r.apply(void 0,I([],j(n),!1)):r;if(!i)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return i}}return re(function(n,a){return a},v(v({},e),{to:t}))}function Ar(t,e){return et(function(r,n,a){return{type:ht,data:F(t)?t(r,n,a):t}},v(v({},e),{to:ae.Parent}))}function Or(t){return{type:R.Choose,conds:t}}var Tr=function(t){var e,r,n=[];try{for(var a=_(t),i=a.next();!i.done;i=a.next())for(var o=i.value,u=0;u<o.actions.length;){if(o.actions[u].type===Oe){n.push(o.actions[u]),o.actions.splice(u,1);continue}u++}}catch(f){e={error:f}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return n};function Ie(t,e,r,n,a,i,o){o===void 0&&(o=!1);var u=o?[]:Tr(a),f=u.length?xt(r,n,u,e):r,l=o?[r]:void 0,p=[];function w(m,g){var E;switch(g.type){case he:{var y=jt(g,f,n,t.options.delays);return i&&typeof y.delay=="number"&&i(y,f,n),y}case Ae:var S=Rt(g,f,n,t.options.delays);if(!J){var A=g.delay;K(!T(A)||typeof S.delay=="number","No delay reference for delay expression '".concat(A,"' was found on machine '").concat(t.id,"'"))}return i&&S.to!==ae.Internal&&(m==="entry"?p.push(S):i(S,f,n)),S;case Ve:{var P=Ut(g,f,n);return i==null||i(P,f,n),P}case vt:{var G=g,L=(E=G.conds.find(function(s){var c=At(s.cond,t.options.guards);return!c||Tt(t,c,f,n,i?void 0:e)}))===null||E===void 0?void 0:E.actions;if(!L)return[];var $=j(Ie(t,e,f,n,[{type:m,actions:Q(W(L),t.options.actions)}],i,o),2),H=$[0],z=$[1];return f=z,l==null||l.push(f),H}case pt:{var L=g.get(f,n.data);if(!L)return[];var C=j(Ie(t,e,f,n,[{type:m,actions:Q(W(L),t.options.actions)}],i,o),2),x=C[0],N=C[1];return f=N,l==null||l.push(f),x}case Xe:{var P=Lt(g,f,n);return i==null||i(P,r,n),P}case Oe:{f=xt(f,n,[g],i?void 0:e),l==null||l.push(f);break}default:var q=se(g,t.options.actions),B=q.exec;if(i)i(q,f,n);else if(B&&l){var ne=l.length-1,ie=v(v({},q),{exec:function(s){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];B.apply(void 0,I([l[ne]],j(c),!1))}});q=ie}return q}}function d(m){var g,E,y=[];try{for(var S=_(m.actions),A=S.next();!A.done;A=S.next()){var P=A.value,G=w(m.type,P);G&&(y=y.concat(G))}}catch(L){g={error:L}}finally{try{A&&!A.done&&(E=S.return)&&E.call(S)}finally{if(g)throw g.error}}return p.forEach(function(L){i(L,f,n)}),p.length=0,y}var h=M(a.map(d));return[h,f]}const Pr=Object.freeze(Object.defineProperty({__proto__:null,actionTypes:ar,after:Mt,assign:_t,cancel:Nt,choose:Or,done:me,doneInvoke:Bt,error:Ht,escalate:Ar,forwardTo:xr,getActionFunction:Ze,initEvent:Ue,isActionObject:Sr,log:br,pure:Er,raise:Dt,resolveActions:Ie,resolveLog:Ut,resolveRaise:jt,resolveSend:Rt,resolveStop:Lt,respond:mr,send:re,sendParent:et,sendTo:yr,sendUpdate:gr,start:It,stop:Ft,toActionObject:se,toActionObjects:Q,toActivityDefinition:Ne},Symbol.toStringTag,{value:"Module"}));var Fe=[],Dr=function(t,e){Fe.push(t);var r=e(t);return Fe.pop(),r},jr=function(t){return t(Fe[Fe.length-1])};function Ct(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[Ot]=function(){return this},e}function Rr(t,e,r,n){var a,i=pr(t.src),o=(a=e==null?void 0:e.options.services)===null||a===void 0?void 0:a[i.type],u=t.data?St(t.data,r,n):void 0,f=o?kt(o,t.id,u):Ct(t.id);return f.meta=t,f}function kt(t,e,r){var n=Ct(e);if(n.deferred=!0,te(t)){var a=n.state=Dr(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return a}}return n}var Le=function(t){return t.type==="atomic"||t.type==="final"};function $t(t){return Object.keys(t.states).map(function(e){return t.states[e]})}function we(t){return $t(t).filter(function(e){return e.type!=="history"})}function qt(t){var e=[t];return Le(t)?e:e.concat(M(we(t).map(qt)))}function be(t,e){var r,n,a,i,o,u,f,l,p=new Set(t),w=tt(p),d=new Set(e);try{for(var h=_(d),m=h.next();!m.done;m=h.next())for(var g=m.value,E=g.parent;E&&!d.has(E);)d.add(E),E=E.parent}catch(z){r={error:z}}finally{try{m&&!m.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}var y=tt(d);try{for(var S=_(d),A=S.next();!A.done;A=S.next()){var g=A.value;if(g.type==="compound"&&(!y.get(g)||!y.get(g).length))w.get(g)?w.get(g).forEach(function(C){return d.add(C)}):g.initialStateNodes.forEach(function(C){return d.add(C)});else if(g.type==="parallel")try{for(var P=(o=void 0,_(we(g))),G=P.next();!G.done;G=P.next()){var L=G.value;d.has(L)||(d.add(L),w.get(L)?w.get(L).forEach(function(C){return d.add(C)}):L.initialStateNodes.forEach(function(C){return d.add(C)}))}}catch(C){o={error:C}}finally{try{G&&!G.done&&(u=P.return)&&u.call(P)}finally{if(o)throw o.error}}}}catch(z){a={error:z}}finally{try{A&&!A.done&&(i=S.return)&&i.call(S)}finally{if(a)throw a.error}}try{for(var $=_(d),H=$.next();!H.done;H=$.next())for(var g=H.value,E=g.parent;E&&!d.has(E);)d.add(E),E=E.parent}catch(z){f={error:z}}finally{try{H&&!H.done&&(l=$.return)&&l.call($)}finally{if(f)throw f.error}}return d}function Gt(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(Le(n))return n.key}else return{}}var a={};return r.forEach(function(i){a[i.key]=Gt(i,e)}),a}function tt(t){var e,r,n=new Map;try{for(var a=_(t),i=a.next();!i.done;i=a.next()){var o=i.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return n}function Ur(t,e){var r=be([t],e);return Gt(t,tt(r))}function Se(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function Nr(t){return I([],j(new Set(M(I([],j(t.map(function(e){return e.ownEvents})),!1)))),!1)}function _e(t,e){return e.type==="compound"?we(e).some(function(r){return r.type==="final"&&Se(t,r)}):e.type==="parallel"?we(e).every(function(r){return _e(t,r)}):!1}function Ir(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function zt(t){return new Set(M(t.map(function(e){return e.tags})))}function Xt(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(T(t)||T(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(a){return Xt(t[a],e[a])})}var Z=function(){function t(e){var r=this,n;this.actions=[],this.activities=gt,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||gt,this.meta=Ir(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Nr(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=Ue;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=Ue;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),T(e))return[e];var a=Object.keys(e);return a.concat.apply(a,I([],j(a.map(function(i){return n.toStrings(e[i],r).map(function(o){return i+r+o})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=Ge(e,["configuration","transitions","tags","machine"]);return v(v({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return We(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;J&&K(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(a){return a.target!==void 0||a.actions.length})},t}(),Vt={sync:!1,autoForward:!1},Jt;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(Jt||(Jt={}));var Fr=function(t){return T(t)?v(v({},Vt),{name:t}):v(v(v({},Vt),{name:hr()}),t)};function Lr(t,e){var r=Fr(e);return jr(function(n){if(!J){var a=te(t)||F(t);K(!!n||a,'Attempted to spawn an Actor (ID: "'.concat(te(t)?t.id:"undefined",'") outside of a service. This will have no effect.'))}return n?n.spawn(t,r.name,r):kt(t,r.name)})}function _r(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function Me(t){return v(v({type:Te},t),{toJSON:function(){t.onDone,t.onError;var e=Ge(t,["onDone","onError"]);return v(v({},e),{type:Te,src:_r(t.src)})}})}var ue="",rt="#",Ee="*",fe={},le=function(t){return t[0]===rt},Mr=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Br=function(t,e,r){var n=r.slice(0,-1).some(function(i){return!("cond"in i)&&!("in"in i)&&(T(i.target)||te(i.target))}),a=e===ue?"the transient event":"event '".concat(e,"'");K(!n,"One or more transitions for ".concat(a," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},Hr=function(){function t(e,r,n,a){n===void 0&&(n="context"in e?e.context:void 0);var i=this,o;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Mr(),r),this.parent=a==null?void 0:a.parent,this.key=this.config.key||(a==null?void 0:a.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:yt),this.id=this.config.id||I([this.machine.key],j(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,J||K(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?pe(this.config.states,function(l,p){var w,d=new t(l,{},void 0,{parent:i,key:p});return Object.assign(i.idMap,v((w={},w[d.id]=d,w),d.idMap)),d}):fe;var u=0;function f(l){var p,w;l.order=u++;try{for(var d=_($t(l)),h=d.next();!h.done;h=d.next()){var m=h.value;f(m)}}catch(g){p={error:g}}finally{try{h&&!h.done&&(w=d.return)&&w.call(d)}finally{if(p)throw p.error}}}f(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(l){var p=l.event;return p===ue}):ue in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=W(this.config.entry||this.config.onEntry).map(function(l){return se(l)}),this.onExit=W(this.config.exit||this.config.onExit).map(function(l){return se(l)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=W(this.config.invoke).map(function(l,p){var w,d;if(te(l)){var h=Re(i.id,p);return i.machine.options.services=v((w={},w[h]=l,w),i.machine.options.services),Me({src:h,id:h})}else if(T(l.src)){var h=l.id||Re(i.id,p);return Me(v(v({},l),{id:h,src:l.src}))}else if(te(l.src)||F(l.src)){var h=l.id||Re(i.id,p);return i.machine.options.services=v((d={},d[h]=l.src,d),i.machine.options.services),Me(v(v({id:h},l),{src:h}))}else{var m=l.src;return Me(v(v({id:Re(i.id,p)},l),{src:m}))}}),this.activities=W(this.config.activities).concat(this.invoke).map(function(l){return Ne(l)}),this.transition=this.transition.bind(this),this.tags=W(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||qt(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,a=n.actions,i=n.activities,o=n.guards,u=n.services,f=n.delays;return new t(this.config,{actions:v(v({},a),e.actions),activities:v(v({},i),e.activities),guards:v(v({},o),e.guards),services:v(v({},u),e.services),delays:v(v({},f),e.delays)},r!=null?r:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return F(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:pe(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===ue,n=this.transitions.filter(function(a){var i=a.eventType===e;return r?i:i||a.eventType===Ee});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(i,o){var u=F(i)?"".concat(e.id,":delay[").concat(o,"]"):i,f=Mt(u,e.id);return e.onEntry.push(re(f,{delay:i})),e.onExit.push(Nt(f)),f},a=ye(r)?r.map(function(i,o){var u=n(i.delay,o);return v(v({},i),{event:u})}):M(Object.keys(r).map(function(i,o){var u=r[i],f=T(u)?{target:u}:u,l=isNaN(+i)?i:+i,p=n(l,o);return W(f).map(function(w){return v(v({},w),{event:p,delay:l})})}));return a.map(function(i){var o=i.delay;return v(v({},e.formatTransition(i)),{delay:o})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var a=e instanceof Z?e.value:ve(e,this.delimiter);if(T(a)){var i=this.getStateNode(a).initial;return i!==void 0?this.getStateNodes((r={},r[a]=i,r)):[this,this.states[a]]}var o=Object.keys(a),u=[this];return u.push.apply(u,I([],j(M(o.map(function(f){return n.getStateNode(f).getStateNodes(a[f])}))),!1)),u},t.prototype.handles=function(e){var r=mt(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof Z?e:Z.create(e),n=Array.from(be([],this.getStateNodes(r.value)));return new Z(v(v({},r),{value:this.resolve(r.value),configuration:n,done:_e(n,this),tags:zt(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var a=this.getStateNode(e),i=a.next(r,n);return!i||!i.transitions.length?this.next(r,n):i},t.prototype.transitionCompoundNode=function(e,r,n){var a=Object.keys(e),i=this.getStateNode(a[0]),o=i._transition(e[a[0]],r,n);return!o||!o.transitions.length?this.next(r,n):o},t.prototype.transitionParallelNode=function(e,r,n){var a,i,o={};try{for(var u=_(Object.keys(e)),f=u.next();!f.done;f=u.next()){var l=f.value,p=e[l];if(p){var w=this.getStateNode(l),d=w._transition(p,r,n);d&&(o[l]=d)}}}catch(y){a={error:y}}finally{try{f&&!f.done&&(i=u.return)&&i.call(u)}finally{if(a)throw a.error}}var h=Object.keys(o).map(function(y){return o[y]}),m=M(h.map(function(y){return y.transitions})),g=h.some(function(y){return y.transitions.length>0});if(!g)return this.next(r,n);var E=M(Object.keys(o).map(function(y){return o[y].configuration}));return{transitions:m,exitSet:M(h.map(function(y){return y.exitSet})),configuration:E,source:r,actions:M(Object.keys(o).map(function(y){return o[y].actions}))}},t.prototype._transition=function(e,r,n){return T(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,ge(r))},t.prototype.next=function(e,r){var n,a,i=this,o=r.name,u=[],f=[],l;try{for(var p=_(this.getCandidates(o)),w=p.next();!w.done;w=p.next()){var d=w.value,h=d.cond,m=d.in,g=e.context,E=m?T(m)&&le(m)?e.matches(ve(this.getStateNodeById(m).path,this.delimiter)):We(ve(m,this.delimiter),ur(this.path.slice(0,-2))(e.value)):!0,y=!1;try{y=!h||Tt(this.machine,h,g,r,e)}catch(P){throw new Error("Unable to evaluate guard '".concat(h.name||h.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(P.message))}if(y&&E){d.target!==void 0&&(f=d.target),u.push.apply(u,I([],j(d.actions),!1)),l=d;break}}}catch(P){n={error:P}}finally{try{w&&!w.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}if(l){if(!f.length)return{transitions:[l],exitSet:[],configuration:e.value?[this]:[],source:e,actions:u};var S=M(f.map(function(P){return i.getRelativeStateNodes(P,e.historyValue)})),A=!!l.internal;return{transitions:[l],exitSet:A?[]:M(f.map(function(P){return i.getPotentiallyReenteringNodes(P)})),configuration:S,source:e,actions:u}}},t.prototype.getPotentiallyReenteringNodes=function(e){if(this.order<e.order)return[this];for(var r=[],n=this,a=e;n&&n!==a;)r.push(n),n=n.parent;return n!==a?[]:(r.push(a),r)},t.prototype.getActions=function(e,r,n,a,i,o,u){var f,l,p,w,d=this,h=o?be([],this.getStateNodes(o.value)):[],m=new Set;try{for(var g=_(Array.from(e).sort(function(x,N){return x.order-N.order})),E=g.next();!E.done;E=g.next()){var y=E.value;(!Se(h,y)||Se(n.exitSet,y)||y.parent&&m.has(y.parent))&&m.add(y)}}catch(x){f={error:x}}finally{try{E&&!E.done&&(l=g.return)&&l.call(g)}finally{if(f)throw f.error}}try{for(var S=_(h),A=S.next();!A.done;A=S.next()){var y=A.value;(!Se(e,y)||Se(n.exitSet,y.parent))&&n.exitSet.push(y)}}catch(x){p={error:x}}finally{try{A&&!A.done&&(w=S.return)&&w.call(S)}finally{if(p)throw p.error}}n.exitSet.sort(function(x,N){return N.order-x.order});var P=Array.from(m).sort(function(x,N){return x.order-N.order}),G=new Set(n.exitSet),L=M(P.map(function(x){var N=[];if(x.type!=="final")return N;var q=x.parent;if(!q.parent)return N;N.push(me(x.id,x.doneData),me(q.id,x.doneData?St(x.doneData,a,i):void 0));var B=q.parent;return B.type==="parallel"&&we(B).every(function(ne){return _e(n.configuration,ne)})&&N.push(me(B.id)),N})),$=P.map(function(x){var N=x.onEntry,q=x.activities.map(function(B){return It(B)});return{type:"entry",actions:Q(u?I(I([],j(N),!1),j(q),!1):I(I([],j(q),!1),j(N),!1),d.machine.options.actions)}}).concat({type:"state_done",actions:L.map(function(x){return Dt(x)})}),H=Array.from(G).map(function(x){return{type:"exit",actions:Q(I(I([],j(x.onExit),!1),j(x.activities.map(function(N){return Ft(N)})),!1),d.machine.options.actions)}}),z=H.concat({type:"transition",actions:Q(n.actions,this.machine.options.actions)}).concat($);if(r){var C=Q(M(I([],j(e),!1).sort(function(x,N){return N.order-x.order}).map(function(x){return x.onExit})),this.machine.options.actions).filter(function(x){return!Pt(x)});return z.concat({type:"stop",actions:C})}return z},t.prototype.transition=function(e,r,n,a){e===void 0&&(e=this.initialState);var i=ge(r),o;if(e instanceof Z)o=n===void 0?e:this.resolveState(Z.from(e,n));else{var u=T(e)?this.resolve(De(this.getResolvedPath(e))):this.resolve(e),f=n!=null?n:this.machine.context;o=this.resolveState(Z.from(u,f))}if(!J&&i.name===Ee)throw new Error("An event cannot have the wildcard type ('".concat(Ee,"')"));if(this.strict&&!this.events.includes(i.name)&&!lr(i.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(i.name,"'"));var l=this._transition(o.value,o,i)||{transitions:[],configuration:[],exitSet:[],source:o,actions:[]},p=be([],this.getStateNodes(o.value)),w=l.configuration.length?be(p,l.configuration):p;return l.configuration=I([],j(w),!1),this.resolveTransition(l,o,o.context,a,i)},t.prototype.resolveRaisedTransition=function(e,r,n,a){var i,o=e.actions;return e=this.transition(e,r,void 0,a),e._event=n,e.event=n.data,(i=e.actions).unshift.apply(i,I([],j(o),!1)),e},t.prototype.resolveTransition=function(e,r,n,a,i){var o,u,f,l,p=this;i===void 0&&(i=Ue);var w=e.configuration,d=!r||e.transitions.length>0,h=d?e.configuration:r?r.configuration:[],m=_e(h,this),g=d?Ur(this.machine,w):void 0,E=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,y=this.getActions(new Set(h),m,e,n,i,r,a),S=r?v({},r.activities):{};try{for(var A=_(y),P=A.next();!P.done;P=A.next()){var G=P.value;try{for(var L=(f=void 0,_(G.actions)),$=L.next();!$.done;$=L.next()){var H=$.value;H.type===ze?S[H.activity.id||H.activity.type]=H:H.type===Xe&&(S[H.activity.id||H.activity.type]=!1)}}catch(Y){f={error:Y}}finally{try{$&&!$.done&&(l=L.return)&&l.call(L)}finally{if(f)throw f.error}}}}catch(Y){o={error:Y}}finally{try{P&&!P.done&&(u=A.return)&&u.call(A)}finally{if(o)throw o.error}}var z=j(Ie(this,r,n,i,y,a,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),C=z[0],x=z[1],N=j(cr(C,Pt),2),q=N[0],B=N[1],ne=C.filter(function(Y){var k;return Y.type===ze&&((k=Y.activity)===null||k===void 0?void 0:k.type)===Te}),ie=ne.reduce(function(Y,k){return Y[k.activity.id]=Rr(k.activity,p.machine,x,i),Y},r?v({},r.children):{}),s=new Z({value:g||r.value,context:x,_event:i,_sessionid:r?r._sessionid:null,historyValue:g?E?dr(E,g):void 0:r?r.historyValue:void 0,history:!g||e.source?r:void 0,actions:g?B:[],activities:g?S:r?r.activities:{},events:[],configuration:h,transitions:e.transitions,children:ie,done:m,tags:zt(h),machine:this}),c=n!==x;s.changed=i.name===Je||c;var b=s.history;b&&delete b.history;var U=!m&&(this._transient||w.some(function(Y){return Y._transient}));if(!d&&(!U||i.name===ue))return s;var O=s;if(!m)for(U&&(O=this.resolveRaisedTransition(O,{type:ct},i,a));q.length;){var D=q.shift();O=this.resolveRaisedTransition(O,D._event,i,a)}var ce=O.changed||(b?!!O.actions.length||c||typeof b.value!=typeof O.value||!Xt(O.value,b.value):void 0);return O.changed=ce,O.history=b,O},t.prototype.getStateNode=function(e){if(le(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=le(e)?e.slice(rt.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&le(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=Ke(e,this.delimiter).slice(),n=this;r.length;){var a=r.shift();if(!a.length)break;n=n.getStateNode(a)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||fe;switch(this.type){case"parallel":return pe(this.initialStateValue,function(i,o){return i?n.getStateNode(o).resolve(e[o]||i):fe});case"compound":if(T(e)){var a=this.getStateNode(e);return a.type==="parallel"||a.type==="compound"?(r={},r[e]=a.initialStateValue,r):e}return Object.keys(e).length?pe(e,function(i,o){return i?n.getStateNode(o).resolve(i):fe}):this.initialStateValue||{};default:return e||fe}},t.prototype.getResolvedPath=function(e){if(le(e)){var r=this.machine.idMap[e.slice(rt.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return Ke(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=wt(this.states,function(n){return n.initialStateValue||fe},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=Le(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r!=null?r:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;T(r.target)?e=le(r.target)?De(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(Le(this))return[this];if(this.type==="compound"&&!this.initial)return J||K(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var r=je(this.initialStateValue);return M(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=j(e),n=r[0],a=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var i=this.getStateNode(n);if(i.type==="history")return i.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(a)},t.prototype.historyValue=function(e){if(Object.keys(this.states).length)return{current:e||this.initialStateValue,states:wt(this.states,function(r,n){if(!e)return r.historyValue();var a=T(e)?void 0:e[n];return r.historyValue(a||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var a=this.target;return a?M(je(a).map(function(o){return n.getFromRelativePath(o)})):n.initialStateNodes}var i=fr(n.path,"states")(e).current;return T(i)?[n.getStateNode(i)]:M(je(i).map(function(o){return r.history==="deep"?n.getFromRelativePath(o):[n.states[o[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=M(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,a;if(this.__cache.events)return this.__cache.events;var i=this.states,o=new Set(this.ownEvents);if(i)try{for(var u=_(Object.keys(i)),f=u.next();!f.done;f=u.next()){var l=f.value,p=i[l];if(p.states)try{for(var w=(n=void 0,_(p.events)),d=w.next();!d.done;d=w.next()){var h=d.value;o.add("".concat(h))}}catch(m){n={error:m}}finally{try{d&&!d.done&&(a=w.return)&&a.call(w)}finally{if(n)throw n.error}}}}catch(m){e={error:m}}finally{try{f&&!f.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!T(n))return n;var a=n[0]===r.delimiter;if(a&&!r.parent)return r.getStateNodeByPath(n.slice(1));var i=a?r.key+n:n;if(r.parent)try{var o=r.parent.getStateNodeByPath(i);return o}catch(u){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(u.message))}else return r.getStateNodeByPath(i)})},t.prototype.formatTransition=function(e){var r=this,n=vr(e.target),a="internal"in e?e.internal:n?n.some(function(f){return T(f)&&f[0]===r.delimiter}):!0,i=this.machine.options.guards,o=this.resolveTarget(n),u=v(v({},e),{actions:Q(W(e.actions)),cond:At(e.cond,i),target:o,source:this,internal:a,eventType:e.event,toJSON:function(){return v(v({},u),{target:u.target?u.target.map(function(f){return"#".concat(f.id)}):void 0,source:"#".concat(r.id)})}});return u},t.prototype.formatTransitions=function(){var e,r,n=this,a;if(!this.config.on)a=[];else if(Array.isArray(this.config.on))a=this.config.on;else{var i=this.config.on,o=Ee,u=i[o],f=u===void 0?[]:u,l=Ge(i,[typeof o=="symbol"?o:o+""]);a=M(Object.keys(l).map(function(S){!J&&S===ue&&K(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(n.id,'".'));var A=oe(S,l[S]);return J||Br(n,S,A),A}).concat(oe(Ee,f)))}var p=this.config.always?oe("",this.config.always):[],w=this.config.onDone?oe(String(me(this.id)),this.config.onDone):[];J||K(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var d=M(this.invoke.map(function(S){var A=[];return S.onDone&&A.push.apply(A,I([],j(oe(String(Bt(S.id)),S.onDone)),!1)),S.onError&&A.push.apply(A,I([],j(oe(String(Ht(S.id)),S.onError)),!1)),A})),h=this.after,m=M(I(I(I(I([],j(w),!1),j(d),!1),j(a),!1),j(p),!1).map(function(S){return W(S).map(function(A){return n.formatTransition(A)})}));try{for(var g=_(h),E=g.next();!E.done;E=g.next()){var y=E.value;m.push(y)}}catch(S){e={error:S}}finally{try{E&&!E.done&&(r=g.return)&&r.call(g)}finally{if(e)throw e.error}}return m},t}(),Yt=!1;function Wt(t,e){return!J&&!("predictableActionArguments"in t)&&!Yt&&(Yt=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new Hr(t,e)}var X=_t,nt=re;let it;typeof it=="undefined"&&(it=$e);const Be={progress:null,loaded:0,error:null,bucketId:void 0,file:void 0,id:void 0},Kt=()=>Wt({predictableActionArguments:!0,schema:{context:{},events:{}},tsTypes:{},context:{...Be},initial:"idle",on:{DESTROY:{actions:"sendDestroy",target:"stopped"}},states:{idle:{on:{ADD:{actions:"addFile"},UPLOAD:{cond:"hasFile",target:"uploading"}}},uploading:{entry:"resetProgress",on:{UPLOAD_PROGRESS:{actions:["incrementProgress","sendProgress"]},UPLOAD_DONE:"uploaded",UPLOAD_ERROR:"error",CANCEL:"idle"},invoke:{src:"uploadFile"}},uploaded:{entry:["setFileMetadata","sendDone"],on:{ADD:{actions:"addFile",target:"idle"},UPLOAD:{actions:"resetContext",target:"uploading"}}},error:{entry:["setError","sendError"],on:{ADD:{actions:"addFile",target:"idle"},UPLOAD:{actions:"resetContext",target:"uploading"}}},stopped:{type:"final"}}},{guards:{hasFile:(t,e)=>!!t.file||!!e.file},actions:{incrementProgress:X({loaded:(t,{loaded:e})=>e,progress:(t,{progress:e})=>e}),setFileMetadata:X({id:(t,{id:e})=>e,bucketId:(t,{bucketId:e})=>e,progress:t=>100}),setError:X({error:(t,{error:e})=>e}),sendProgress:()=>{},sendError:()=>{},sendDestroy:()=>{},sendDone:()=>{},resetProgress:X({progress:t=>null,loaded:t=>0}),resetContext:X(t=>Be),addFile:X({file:(t,{file:e})=>e,bucketId:(t,{bucketId:e})=>e,id:(t,{id:e})=>e})},services:{uploadFile:(t,e)=>r=>{const n=e.file||t.file,a=new it;a.append("file[]",n);let i=0;return qe(e.url,a,{fileId:e.id||t.id,bucketId:e.bucketId||t.bucketId,accessToken:e.accessToken,adminSecret:e.adminSecret,name:e.name||n.name,onUploadProgress:o=>{const u=o.total?Math.round(o.loaded*n.size/o.total):0,f=u-i;i=u,r({type:"UPLOAD_PROGRESS",progress:o.total?Math.round(u*100/o.total):0,loaded:u,additions:f})}}).then(({fileMetadata:o,error:u})=>{if(u&&r({type:"UPLOAD_ERROR",error:u}),o&&!("processedFiles"in o)){const{id:f,bucketId:l}=o;r({type:"UPLOAD_DONE",id:f,bucketId:l})}if(o&&"processedFiles"in o){const{id:f,bucketId:l}=o.processedFiles[0];r({type:"UPLOAD_DONE",id:f,bucketId:l})}}),()=>{}}}}),{pure:at,sendParent:He}=Pr,Cr=()=>Wt({id:"files-list",schema:{context:{},events:{}},tsTypes:{},predictableActionArguments:!0,context:{progress:null,files:[],loaded:0,total:0},initial:"idle",on:{UPLOAD:{cond:"hasFileToDownload",actions:"addItem",target:"uploading"},ADD:{actions:"addItem"},REMOVE:{actions:"removeItem"}},states:{idle:{entry:["resetProgress","resetLoaded","resetTotal"],on:{CLEAR:{actions:"clearList",target:"idle"}}},uploading:{entry:["upload","startProgress","resetLoaded","resetTotal"],on:{UPLOAD_PROGRESS:{actions:["incrementProgress"]},UPLOAD_DONE:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],UPLOAD_ERROR:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],CANCEL:{actions:"cancel",target:"idle"}}},uploaded:{entry:"setUploaded",on:{CLEAR:{actions:"clearList",target:"idle"}}},error:{on:{CLEAR:{actions:"clearList",target:"idle"}}}}},{guards:{hasFileToDownload:(t,e)=>t.files.some(r=>r.getSnapshot().matches("idle"))||!!e.files,isAllUploaded:t=>t.files.every(e=>{var r;return(r=e.getSnapshot())==null?void 0:r.matches("uploaded")}),isAllUploadedOrError:t=>t.files.every(e=>{const r=e.getSnapshot();return(r==null?void 0:r.matches("error"))||(r==null?void 0:r.matches("uploaded"))})},actions:{incrementProgress:X((t,e)=>{const r=t.loaded+e.additions,n=Math.round(r*100/t.total);return{...t,loaded:r,progress:n}}),setUploaded:X({progress:t=>100,loaded:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>e.matches("uploaded")).reduce((e,r)=>{var n;return e+((n=r.context.file)==null?void 0:n.size)},0)}),resetTotal:X({total:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>!e.matches("uploaded")).reduce((e,r)=>{var n;return e+((n=r.context.file)==null?void 0:n.size)},0)}),resetLoaded:X({loaded:t=>0}),startProgress:X({progress:t=>0}),resetProgress:X({progress:t=>null}),addItem:X((t,{files:e,bucketId:r})=>{const n=e?Array.isArray(e)?e:"item"in e?Array.from(e):[e]:[],a=t.total+n.reduce((o,u)=>o+u.size,0),i=Math.round(t.loaded*100/a);return{files:[...t.files,...n.map(o=>Lr(Kt().withConfig({actions:{sendProgress:He((u,{additions:f})=>({type:"UPLOAD_PROGRESS",additions:f})),sendDone:He("UPLOAD_DONE"),sendError:He("UPLOAD_ERROR"),sendDestroy:He("REMOVE")}}).withContext({...Be,file:o,bucketId:r}),{sync:!0}))],total:a,loaded:t.loaded,progress:i}}),removeItem:X({files:t=>t.files.filter(e=>{var n,a;const r=(n=e.getSnapshot())==null?void 0:n.matches("stopped");return r&&((a=e.stop)==null||a.call(e)),!r})}),clearList:at(t=>t.files.map(e=>nt({type:"DESTROY"},{to:e.id}))),upload:at((t,e)=>t.files.map(r=>nt(e,{to:r.id}))),cancel:at(t=>t.files.map(e=>nt({type:"CANCEL"},{to:e.id})))}}),kr=async(t,e)=>new Promise(r=>{e.send({type:"UPLOAD",...t}),e.subscribe(n=>{var a;n.matches("error")?r({error:n.context.error,isError:!0,isUploaded:!1}):n.matches("uploaded")&&r({error:null,isError:!1,isUploaded:!0,id:n.context.id,bucketId:n.context.id,name:(a=n.context.file)==null?void 0:a.name})})}),$r=async(t,e)=>new Promise(r=>{e.send({type:"UPLOAD",...t,files:t.files}),e.onTransition(n=>{n.matches("error")?r({errors:n.context.files.filter(a=>{var i;return(i=a.getSnapshot())==null?void 0:i.context.error}),isError:!0,files:[]}):n.matches("uploaded")&&r({errors:[],isError:!1,files:n.context.files})})});V.HasuraStorageApi=ft,V.HasuraStorageClient=er,V.INITIAL_FILE_CONTEXT=Be,V.appendImageTransformationParameters=xe,V.createFileUploadMachine=Kt,V.createMultipleFilesUploadMachine=Cr,V.uploadFilePromise=kr,V.uploadMultipleFilesPromise=$r,Object.defineProperty(V,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=hasura-storage-js.umd.js.map
