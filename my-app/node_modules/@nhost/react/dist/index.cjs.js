"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const E=require("@nhost/nhost-js"),p=require("react"),s=require("@xstate/react"),O=require("jwt-decode"),A=E.NhostClient;class N extends A{constructor(t){super({...t,start:!1})}}const x=p.createContext({}),U=({nhost:e,initial:t,...n})=>{const c=s.useInterpret(e.auth.client.machine,{devTools:e.devTools});e.auth.client.start({interpreter:c,initialSession:t,devTools:e.devTools});const h=p.useRef(!0);return p.useEffect(()=>{h.current?h.current=!1:t&&c.send("SESSION_UPDATE",{data:{session:t}})},[t,c]),p.createElement(x.Provider,{value:e},n.children)},M=U,f=()=>{var n;const t=(n=p.useContext(x).auth)==null?void 0:n.client.interpreter;if(!t)throw Error("Could not find the Nhost auth client. Did you wrap your app in <NhostProvider />?");return t},I=()=>{const e=f();return s.useSelector(e,t=>({isAuthenticated:t.matches({authentication:"signedIn"}),isLoading:t.hasTag("loading"),error:t.context.errors.authentication||null,isError:t.matches({authentication:{signedOut:"failed"}}),connectionAttempts:t.context.importTokenAttempts}),(t,n)=>t.isAuthenticated===n.isAuthenticated&&t.isLoading===n.isLoading&&t.connectionAttempts===n.connectionAttempts)};function L({children:e}){const{isAuthenticated:t}=I();return t?p.createElement(p.Fragment,null,e):null}function R({children:e}){const{isAuthenticated:t}=I();return t?null:p.createElement(p.Fragment,null,e)}const y=()=>{const e=f();return s.useSelector(e,t=>t.context.accessToken.value)},v=()=>p.useContext(x),K=()=>{const e=v(),[t,n]=p.useState(null),c=!t,h=!!t,[d,S]=p.useState(!1);return{add:async a=>{S(!0);const o=await E.addSecurityKeyPromise(e.auth.client,a),{error:i}=o;return i&&n(i),S(!1),o},isLoading:d,isSuccess:c,isError:h,error:t}},D=()=>{const e=f(),[t,n]=p.useState(!!e.status&&e.getSnapshot().matches({authentication:"signedIn"}));return p.useEffect(()=>e.subscribe(h=>{const d=h.matches({authentication:"signedIn"});n(d)}).unsubscribe,[e]),t};function V(e){const t=v(),n=p.useMemo(()=>E.createChangeEmailMachine(t.auth.client),[t]),c=s.useInterpret(n),h=s.useSelector(c,o=>o.matches("requesting")),d=s.useSelector(c,o=>o.context.error),S=s.useSelector(c,o=>o.matches("idle.error")),m=s.useSelector(c,o=>o.matches("idle.success"));return{changeEmail:p.useCallback(async(o,i=e)=>E.changeEmailPromise(c,o,i),[c,e]),isLoading:h,needsEmailVerification:m,isError:S,error:d}}const F=()=>{const e=v(),t=p.useMemo(()=>E.createChangePasswordMachine(e.auth.client),[e]),n=s.useInterpret(t),c=s.useSelector(n,a=>a.matches({idle:"error"})),h=s.useSelector(n,a=>a.matches({idle:"success"})),d=s.useSelector(n,a=>a.context.error),S=s.useSelector(n,a=>a.matches("requesting"));return{changePassword:a=>E.changePasswordPromise(n,a),isLoading:S,isSuccess:h,isError:c,error:d}},_=()=>{const e=v(),t=p.useMemo(()=>E.createEnableMfaMachine(e.auth.client),[e]),n=s.useInterpret(t),c=s.useSelector(n,l=>l.matches({idle:"error"})||l.matches({generated:{idle:"error"}})),h=s.useSelector(n,l=>l.matches("generating")),d=s.useSelector(n,l=>l.matches("generated")),S=s.useSelector(n,l=>l.matches({generated:"activating"})),m=s.useSelector(n,l=>l.matches({generated:"activated"})),a=s.useSelector(n,l=>l.context.error),o=s.useSelector(n,l=>l.context.imageUrl||"");return{generateQrCode:()=>E.generateQrCodePromise(n),isGenerating:h,qrCodeDataUrl:o,isGenerated:d,activateMfa:l=>E.activateMfaPromise(n,l),isActivating:S,isActivated:m,isError:c,error:a}},w=()=>{const e=y();return e?O.jwtDecode(e):null},k=e=>{const t=v(),n=g=>{e.send({type:"ADD",file:g.file,bucketId:g.bucketId||l})},c=g=>E.uploadFilePromise({url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret,...g},e),h=()=>{e.send("CANCEL")},d=()=>{e.send("DESTROY")},S=s.useSelector(e,g=>g.matches("uploading")),m=s.useSelector(e,g=>g.matches("uploaded")),a=s.useSelector(e,g=>g.matches("error")),o=s.useSelector(e,g=>g.context.error||null),i=s.useSelector(e,g=>g.context.progress),r=s.useSelector(e,g=>g.context.id),l=s.useSelector(e,g=>g.context.bucketId),u=s.useSelector(e,g=>{var P;return(P=g.context.file)==null?void 0:P.name});return{add:n,upload:c,cancel:h,destroy:d,isUploaded:m,isUploading:S,isError:a,error:o,progress:i,id:r,bucketId:l,name:u}},q=()=>{const e=s.useInterpret(E.createFileUploadMachine);return k(e)},T=()=>{const e=w();return(e==null?void 0:e["https://hasura.io/jwt/claims"])||null},H=e=>{const t=T();return(t==null?void 0:t[e.startsWith("x-hasura-")?e:`x-hasura-${e}`])||null},j=()=>{const e=v(),[t,n]=p.useState([]),c=s.useInterpret(E.createMultipleFilesUploadMachine,{},u=>{u.event.type==="UPLOAD_ERROR"?n(u.context.files.filter(g=>{var P;return(P=g.getSnapshot())==null?void 0:P.context.error})):(u.matches("uploaded")||u.event.type==="CLEAR")&&t.length>0&&n([])}),h=u=>{c.send({type:"ADD",...u})},d=u=>E.uploadMultipleFilesPromise({url:e.storage.url,accessToken:e.auth.getAccessToken(),adminSecret:e.adminSecret,...u},c),S=()=>{c.send("CANCEL")},m=()=>{c.send("CLEAR")},a=s.useSelector(c,u=>u.matches("uploading")),o=s.useSelector(c,u=>u.matches("uploaded")),i=s.useSelector(c,u=>u.matches("error")),r=s.useSelector(c,u=>u.context.progress),l=s.useSelector(c,u=>u.context.files);return{upload:d,add:h,clear:m,cancel:S,progress:r,isUploaded:o,isUploading:a,files:l,isError:i,errors:t}},Q=e=>{const[t,n]=p.useState(!0),c=y();p.useEffect(()=>{n(!1)},[]);const h=p.useContext(x);return new Proxy({},{get(d,S){let m=`${h.auth.client.backendUrl}/signin/provider/${S}`;const a=e!=null&&e.connect?{connect:c}:{};return E.encodeQueryParameters(m,E.rewriteRedirectTo(t?void 0:h.auth.client.clientUrl,{...e,...a}))}})},J=e=>{const t=v(),n=p.useMemo(()=>E.createResetPasswordMachine(t.auth.client),[t]),c=s.useInterpret(n),h=s.useSelector(c,o=>o.matches("requesting")),d=s.useSelector(c,o=>o.context.error),S=s.useSelector(c,o=>o.matches("idle.error")),m=s.useSelector(c,o=>o.matches("idle.success"));return{resetPassword:(o,i=e)=>E.resetPasswordPromise(c,o,i),isLoading:h,isSent:m,isError:S,error:d}},Y=e=>{const t=v(),n=p.useMemo(()=>E.createSendVerificationEmailMachine(t.auth.client),[t]),c=s.useInterpret(n),h=s.useSelector(c,o=>o.matches({idle:"error"})),d=s.useSelector(c,o=>o.matches({idle:"success"})),S=s.useSelector(c,o=>o.context.error),m=s.useSelector(c,o=>o.matches("requesting"));return{sendEmail:(o,i=e)=>E.sendVerificationEmailPromise(c,o,i),isLoading:m,isSent:d,isError:h,error:S}},$=()=>{const e=f(),t=()=>E.signInAnonymousPromise(e),n=s.useSelector(e,a=>a.context.errors.authentication||null,(a,o)=>(a==null?void 0:a.error)===(o==null?void 0:o.error)),c=s.useSelector(e,a=>a.matches({authentication:{authenticating:"anonymous"}})),h=s.useSelector(e,a=>a.matches({authentication:"signedIn"})),d=s.useSelector(e,a=>a.matches({authentication:{signedOut:"failed"}})),S=s.useSelector(e,a=>a.context.user,(a,o)=>(a==null?void 0:a.id)===(o==null?void 0:o.id));return{accessToken:s.useSelector(e,a=>a.context.accessToken.value),error:n,isError:d,isLoading:c,isSuccess:h,signInAnonymous:t,user:S}},G=()=>{const e=f(),t=(u,g)=>E.signInEmailPasswordPromise(e,u,g),n=u=>E.signInMfaTotpPromise(e,u),c=s.useSelector(e,u=>u.context.user,(u,g)=>(u==null?void 0:u.id)===(g==null?void 0:g.id)),h=s.useSelector(e,u=>u.context.accessToken.value),d=s.useSelector(e,u=>u.context.refreshToken.value),S=s.useSelector(e,u=>u.context.errors.authentication||null,(u,g)=>(u==null?void 0:u.error)===(g==null?void 0:g.error)),m=s.useSelector(e,u=>u.matches({authentication:"signedIn"})),a=s.useSelector(e,u=>u.matches({authentication:{authenticating:"password"}}),(u,g)=>u===g),o=s.useSelector(e,u=>u.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(u,g)=>u===g),i=s.useSelector(e,u=>u.matches({authentication:{signedOut:"needsMfa"}}),(u,g)=>u===g),r=s.useSelector(e,u=>u.matches({authentication:{signedOut:"failed"}}),(u,g)=>u===g),l=s.useSelector(e,u=>u.context.mfa);return{accessToken:h,refreshToken:d,error:S,isError:r,isLoading:a,isSuccess:m,needsEmailVerification:o,needsMfaOtp:i,mfa:l,sendMfaOtp:n,signInEmailPassword:t,user:c}};function W(e){const t=f(),n=(m,a=e)=>E.signInEmailPasswordlessPromise(t,m,a),c=s.useSelector(t,m=>m.context.errors.registration||null,(m,a)=>(m==null?void 0:m.error)===(a==null?void 0:a.error)),h=s.useSelector(t,m=>m.matches("registration.passwordlessEmail")),d=s.useSelector(t,m=>m.matches("registration.incomplete.needsEmailVerification")),S=s.useSelector(t,m=>m.matches("registration.incomplete.failed"));return{signInEmailPasswordless:n,isLoading:h,isSuccess:d,isError:S,error:c}}const z=()=>{const e=f(),t=i=>E.signInEmailSecurityKeyPromise(e,i),n=s.useSelector(e,i=>i.context.user,(i,r)=>(i==null?void 0:i.id)===(r==null?void 0:r.id)),c=s.useSelector(e,i=>i.context.accessToken.value),h=s.useSelector(e,i=>i.context.refreshToken.value),d=s.useSelector(e,i=>i.context.errors.authentication||null,(i,r)=>(i==null?void 0:i.error)===(r==null?void 0:r.error)),S=s.useSelector(e,i=>i.matches({authentication:"signedIn"})),m=s.useSelector(e,i=>i.matches({authentication:{authenticating:"securityKeyEmail"}}),(i,r)=>i===r),a=s.useSelector(e,i=>i.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(i,r)=>i===r),o=s.useSelector(e,i=>i.matches({authentication:{signedOut:"failed"}}),(i,r)=>i===r);return{accessToken:c,refreshToken:h,error:d,isError:o,isLoading:m,isSuccess:S,needsEmailVerification:a,signInEmailSecurityKey:t,user:n}},C=()=>{const e=f();return s.useSelector(e,t=>t.context.user,(t,n)=>(t&&JSON.stringify(t))===(n&&JSON.stringify(n)))},B=()=>{const e=C(),t=v(),n=T(),c=e?(n==null?void 0:n["x-hasura-auth-elevated"])===(e==null?void 0:e.id):!1,[h,d]=p.useState(!!c),S=m=>E.elevateEmailSecurityKeyPromise(t.auth.client,m);return p.useEffect(()=>{d(!!c)},[c]),{elevated:h,elevateEmailSecurityKey:S}},X=()=>{const e=f(),t=o=>E.signInPATPromise(e,o),n=s.useSelector(e,o=>o.context.user,(o,i)=>(o==null?void 0:o.id)===(i==null?void 0:i.id)),c=s.useSelector(e,o=>o.context.accessToken.value),h=s.useSelector(e,o=>o.context.refreshToken.value),d=s.useSelector(e,o=>o.context.errors.authentication||null,(o,i)=>(o==null?void 0:o.error)===(i==null?void 0:i.error)),S=s.useSelector(e,o=>o.matches({authentication:"signedIn"})),m=s.useSelector(e,o=>o.matches({authentication:{authenticating:"password"}}),(o,i)=>o===i),a=s.useSelector(e,o=>o.matches({authentication:{signedOut:"failed"}}),(o,i)=>o===i);return{accessToken:c,refreshToken:h,error:d,isError:a,isLoading:m,isSuccess:S,signInPAT:t,user:n}};function Z(e){const t=f(),[n,c]=p.useState(""),h=(r,l=e)=>(c(r),E.signInSmsPasswordlessPromise(t,r,l)),d=async(...r)=>{if(r.length===2){const[u,g]=r;return E.signInSmsPasswordlessOtpPromise(t,u,g)}const[l]=r;return E.signInSmsPasswordlessOtpPromise(t,n,l)},S=s.useSelector(t,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),m=s.useSelector(t,r=>r.matches("registration.passwordlessSms")||r.matches("registration.passwordlessSmsOtp")),a=s.useSelector(t,r=>r.matches("authentication.signedIn")),o=s.useSelector(t,r=>r.matches("registration.incomplete.needsOtp")),i=s.useSelector(t,r=>r.matches("registration.incomplete.failed"));return{signInSmsPasswordless:h,sendOtp:d,isLoading:m,isSuccess:a,needsOtp:o,isError:i,error:S}}const b=(e=!1)=>{const t=f(),n=d=>E.signOutPromise(t,typeof d=="boolean"?d:e),c=s.useSelector(t,d=>d.matches({authentication:{signedOut:"success"}}),(d,S)=>d===S),h=s.useSelector(t,d=>d.context.errors.signout||null,(d,S)=>(d==null?void 0:d.error)===(S==null?void 0:S.error));return{signOut:n,isSuccess:c,error:h}},ee=e=>{const t=f(),n=s.useSelector(t,r=>!!r.context.errors.registration),c=s.useSelector(t,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),h=s.useSelector(t,r=>r.matches("registration.emailPassword")),d=s.useSelector(t,r=>r.matches("registration.incomplete.needsEmailVerification")),S=s.useSelector(t,r=>r.matches({authentication:"signedIn",registration:"complete"})),m=(r,l,u=e)=>E.signUpEmailPasswordPromise(t,r,l,u),a=s.useSelector(t,r=>r.context.user,(r,l)=>(r==null?void 0:r.id)===(l==null?void 0:l.id)),o=s.useSelector(t,r=>r.context.accessToken.value),i=s.useSelector(t,r=>r.context.refreshToken.value);return{accessToken:o,refreshToken:i,error:c,isError:n,isLoading:h,isSuccess:S,needsEmailVerification:d,signUpEmailPassword:m,user:a}},te=e=>{const t=f(),n=s.useSelector(t,r=>!!r.context.errors.registration),c=s.useSelector(t,r=>r.context.errors.registration||null,(r,l)=>(r==null?void 0:r.error)===(l==null?void 0:l.error)),h=s.useSelector(t,r=>r.matches("registration.securityKey")),d=s.useSelector(t,r=>r.matches("registration.incomplete.needsEmailVerification")),S=s.useSelector(t,r=>r.matches({authentication:"signedIn",registration:"complete"})),m=(r,l=e)=>E.signUpEmailSecurityKeyPromise(t,r,l),a=s.useSelector(t,r=>r.context.user,(r,l)=>(r==null?void 0:r.id)===(l==null?void 0:l.id)),o=s.useSelector(t,r=>r.context.accessToken.value),i=s.useSelector(t,r=>r.context.refreshToken.value);return{accessToken:o,refreshToken:i,error:c,isError:n,isLoading:h,isSuccess:S,needsEmailVerification:d,signUpEmailSecurityKey:m,user:a}},se=()=>{const e=f();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.avatarUrl},(t,n)=>t===n)},ne=()=>{const e=f();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.defaultRole},(t,n)=>t===n)},re=()=>{const e=f();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.displayName},(t,n)=>t===n)},oe=()=>{const e=f();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.email},(t,n)=>t===n)},ce=()=>{const e=f();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.id},(t,n)=>t===n)},ie=()=>{const e=f();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.isAnonymous},(t,n)=>t===n)},ue=()=>{const e=f();return s.useSelector(e,t=>{var n;return(n=t.context.user)==null?void 0:n.locale},(t,n)=>t===n)},ae=()=>{const e=f();return s.useSelector(e,t=>{var n;return t.matches("authentication.signedIn")?((n=t.context.user)==null?void 0:n.roles)||[]:[]})};Object.defineProperty(exports,"NHOST_REFRESH_TOKEN_KEY",{enumerable:!0,get:()=>E.NHOST_REFRESH_TOKEN_KEY});exports.NhostClient=N;exports.NhostProvider=U;exports.NhostReactContext=x;exports.NhostReactProvider=M;exports.SignedIn=L;exports.SignedOut=R;exports.VanillaNhostClient=A;exports.useAccessToken=y;exports.useAddSecurityKey=K;exports.useAuthInterpreter=f;exports.useAuthenticated=D;exports.useAuthenticationStatus=I;exports.useChangeEmail=V;exports.useChangePassword=F;exports.useConfigMfa=_;exports.useDecodedAccessToken=w;exports.useElevateSecurityKeyEmail=B;exports.useFileUpload=q;exports.useFileUploadItem=k;exports.useHasuraClaim=H;exports.useHasuraClaims=T;exports.useMultipleFilesUpload=j;exports.useNhostClient=v;exports.useProviderLink=Q;exports.useResetPassword=J;exports.useSendVerificationEmail=Y;exports.useSignInAnonymous=$;exports.useSignInEmailPassword=G;exports.useSignInEmailPasswordless=W;exports.useSignInEmailSecurityKey=z;exports.useSignInPAT=X;exports.useSignInSmsPasswordless=Z;exports.useSignOut=b;exports.useSignUpEmailPassword=ee;exports.useSignUpEmailSecurityKeyEmail=te;exports.useUserAvatarUrl=se;exports.useUserData=C;exports.useUserDefaultRole=ne;exports.useUserDisplayName=re;exports.useUserEmail=oe;exports.useUserId=ce;exports.useUserIsAnonymous=ie;exports.useUserLocale=ue;exports.useUserRoles=ae;
//# sourceMappingURL=index.cjs.js.map
